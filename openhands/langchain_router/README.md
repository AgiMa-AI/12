# LangChain Router for OpenHands

This module provides a routing system for OpenHands using LangChain, allowing intelligent routing of requests to the most appropriate AI assistant.

## Features

- **Intelligent Routing**: Automatically route requests to the most appropriate model based on content
- **Thought Tree Generation**: Show multiple paths of reasoning for transparent decision making
- **Self-Correction Mechanism**: Identify and fix errors in responses
- **Hybrid Retrieval Strategy**: Combine multiple retrieval methods for better context
- **Multi-Agent Collaboration**: Coordinate multiple specialized agents for complex tasks
- **Advanced Memory Management**: Enhance context retention with hierarchical memory
- **BabyAGI Integration**: Manage prompts, organize conversations, and handle fixed task types

## Installation

The LangChain Router is included with OpenHands. To use it, you need to install the required dependencies:

```bash
pip install langchain langchain-community langchain-core faiss-cpu chromadb tiktoken
```

## Usage

### Basic Usage

```python
from openhands import get_langchain_router

# Get the LangChain Router integration
router = get_langchain_router()

# Route a request
result = router.route_request(
    user_input="Write a Python function to calculate Fibonacci numbers",
    conversation_id="conversation-123",
    conversation_history="User: Can you help me with some Python code?"
)

# Get the response
response = result.get("response")
model = result.get("model")

print(f"Response from {model}: {response}")
```

### Manual Model Selection

```python
# Route a request to a specific model
result = router.route_request(
    user_input="Write a Python function to calculate Fibonacci numbers",
    conversation_id="conversation-123",
    conversation_history="User: Can you help me with some Python code?",
    model_name="code"  # Manually select the code model
)
```

### Using BabyAGI

```python
# Use BabyAGI for prompt management
result = router.route_request(
    user_input="create prompt: code_review\ntemplate: Please review the following code:\n\n{code}\n\nProvide feedback on:",
    conversation_id="conversation-123"
)

# Use BabyAGI for conversation organization
result = router.route_request(
    user_input="summarize: conversation-123\nconversation: User: Can you help me with Python?\nAssistant: Sure, what do you need help with?",
    conversation_id="conversation-123"
)
```

## Configuration

You can configure the LangChain Router by modifying the configuration file at `/.openhands-state/langchain_router_config.json`. Alternatively, you can use the API to update the configuration:

```python
from openhands import get_langchain_router
from openhands.langchain_router.config import RouterConfig, ModelConfig, ModelCapability, RouterRule

# Get the LangChain Router integration
router = get_langchain_router()

# Add a new model
router.add_model({
    "name": "math",
    "description": "Math-focused AI assistant",
    "capabilities": [
        {"name": "mathematics", "score": 0.9},
        {"name": "problem_solving", "score": 0.8}
    ],
    "context_window": 8000,
    "max_tokens": 1000
})

# Add a new routing rule
router.add_rule({
    "name": "math_rule",
    "description": "Route math-related queries to the math assistant",
    "priority": 80,
    "condition": "'math' in input.lower() or 'calculate' in input.lower()",
    "target_model": "math"
})
```

## Command-Line Interface

The LangChain Router includes a command-line interface for testing and demonstration:

```bash
# Start a chat session
python -m openhands.langchain_router.cli chat

# List available models
python -m openhands.langchain_router.cli list-models

# Add a new model
python -m openhands.langchain_router.cli add-model --name math --description "Math-focused AI assistant" --capabilities '[{"name": "mathematics", "score": 0.9}]'

# Add a new routing rule
python -m openhands.langchain_router.cli add-rule --name math_rule --description "Route math queries" --condition "'math' in input.lower()" --target-model math
```

## Example

See the example script at `/workspace/OpenHands/examples/langchain_router_example.py` for a complete example of using the LangChain Router.

## Advanced Features

### Thought Tree Generation

The thought tree generator shows multiple paths of reasoning for a given input, allowing for more transparent and explainable decision making.

### Self-Correction Mechanism

The self-correction mechanism can identify and fix errors in the responses generated by language models, improving the quality and accuracy of responses.

### Hybrid Retrieval Strategy

The hybrid retrieval strategy combines multiple retrieval methods (vector search, BM25, multi-query expansion) to get the most relevant information for a given query.

### Multi-Agent Collaboration

The multi-agent collaboration framework coordinates multiple specialized agents to solve complex tasks, enabling more complex problem-solving than any single agent could achieve.

### BabyAGI

BabyAGI manages prompts, organizes conversations, and handles fixed task types, providing a more structured approach to task management.